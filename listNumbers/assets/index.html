 <!DOCTYPE html>

<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="x-ua-compatible" content="ie=edge" />
      <title>List Phone numbers</title>
      <link
         rel="icon"
         href="https://twilio-labs.github.io/function-templates/static/v1/favicon.ico"
         />
      <link
         rel="stylesheet"
         href="https://twilio-labs.github.io/function-templates/static/v1/ce-paste-theme.css"
         />
      <link rel="stylesheet" href="styles.css" />
      <link
         rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/build/css/intlTelInput.min.css"
         integrity="sha256-xpVuhxDPR39wFEQDha4W7kuMx+z9Av3dTS8MbH/RWEU="
         crossorigin="anonymous"
         />
      <script
         src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/build/js/intlTelInput.min.js"
         integrity="sha256-uPbemOnf3P4eaeLHebLwPC71YRbu3WNBvO4ibYeBnGs="
         crossorigin="anonymous"
         ></script>
      <style>
         .success {
         border-color: #bce8f1;
         color: #31708f;
         background-color: #d9edf7;
         }
         .warning {
         color: #c21e1e;
         background-color: #f2dede;
         border-color: #ebccd1;
         }
      </style>
   </head>
   <body onload=mask()>
      <div class="page-top">
         <header>
            <div id="twilio-logo">
               <a href="https://www.twilio.com/" target="_blank" rel="noopener">
                  <svg
                     class="logo"
                     data-name="Layer 1"
                     xmlns="http://www.w3.org/2000/svg"
                     viewbox="0 0 60 60"
                     >
                     <title>Twilio Logo</title>
                     <path
                        class="cls-1"
                        d="M30,15A15,15,0,1,0,45,30,15,15,0,0,0,30,15Zm0,26A11,11,0,1,1,41,30,11,11,0,0,1,30,41Zm6.8-14.7a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,36.8,26.3Zm0,7.4a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,36.8,33.7Zm-7.4,0a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,29.4,33.7Zm0-7.4a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,29.4,26.3Z"
                        />
                  </svg>
               </a>
            </div>
            <nav>
               <span>Your Twilio application</span>
               <aside>
                  <svg
                     class="icon"
                     role="img"
                     aria-hidden="true"
                     width="100%"
                     height="100%"
                     viewBox="0 0 20 20"
                     aria-labelledby="NewIcon-1577"
                     >
                     <path
                        fill="currentColor"
                        fill-rule="evenodd"
                        d="M6.991 7.507c.003-.679 1.021-.675 1.019.004-.012 2.956 1.388 4.41 4.492 4.48.673.016.66 1.021-.013 1.019-2.898-.011-4.327 1.446-4.48 4.506-.033.658-1.01.639-1.018-.02-.03-3.027-1.382-4.49-4.481-4.486-.675 0-.682-1.009-.008-1.019 3.02-.042 4.478-1.452 4.49-4.484zm.505 2.757l-.115.242c-.459.9-1.166 1.558-2.115 1.976l.176.08c.973.465 1.664 1.211 2.083 2.22l.02.05.088-.192c.464-.973 1.173-1.685 2.123-2.124l.039-.018-.118-.05c-.963-.435-1.667-1.117-2.113-2.034l-.068-.15zm10.357-8.12c.174.17.194.434.058.625l-.058.068-1.954 1.905 1.954 1.908a.482.482 0 010 .694.512.512 0 01-.641.056l-.07-.056-1.954-1.908-1.954 1.908a.511.511 0 01-.71 0 .482.482 0 01-.058-.626l.058-.068 1.954-1.908-1.954-1.905a.482.482 0 010-.693.512.512 0 01.64-.057l.07.057 1.954 1.905 1.954-1.905a.511.511 0 01.71 0z"
                        ></path>
                  </svg>
                  Live
               </aside>
            </nav>
         </header>
      </div>
      <main>
         <div class="content">
         <h1>
            <img
               src="https://twilio-labs.github.io/function-templates/static/v1/success.svg"
               />
            <div>
               <p>Welcome!</p>
               <p>Your live application with Twilio is ready to use!</p>
            </div>
         </h1>

         <p>Before you start, make sure that the checkbox "Add my Twilio Credentials (ACCOUNT_SID) and (AUTH_TOKEN) to ENV" is checked in the "Environmental Variables" of this Function. If it's not checked, enable it and click "Deploy All" at the bottom.  </p>
         <h2>List Active numbers on your main accounts or subaccount</h2>

         <p>If you have a <b>large amount of numbers</b> on your account, the "List Numbers" request might timeout. Use Pagination if you have thousands of numbers on your account, and rely on the "Download without listing numbers" button.
         </p>

         <p>Because this is a publicly accessible URL that automatically uses your Account SID and auth_token, to limit it's access, please set a password in your <a href="https://console.twilio.com/us1/develop/functions/services">Function</a> - open the Function and click on "Environment Variables" in the bottom left corner, and change the value of Password.
            <br>The default Password is <i><b>1</b></i>. 
         </p>
         Password:<input id="password" type="password" name="password" />
         <br />
         <br>
         <p>You are working with account: 
         <div id="masking"></div>
         <div> <button onclick="unmask()">Show Account</button> </div>
         <br>
         <div id="status_acc"></div>
         </p>
         <br>
         <div>
            <button onclick="checkAll()">Select all</button> <br>
            <input type="checkbox" id="accountSid" class="pl" name="accountSid" checked>accountSid
            <input type="checkbox" id="addressSid" class="pl" name="addressSid">addressSid
            <input type="checkbox" id="addressRequirements" class="pl" name="addressRequirements" >addressRequirements
            <input type="checkbox" id="beta" class="pl" name="beta" >beta
            <input type="checkbox" id="bundleSid" class="pl" name="bundleSid" >bundleSid
            <input type="checkbox" id="fax" class="pl" name="fax">capabilities fax
            <input type="checkbox" id="voice" class="pl" name="voice" checked>capabilities voice
            <input type="checkbox" id="sms" class="pl" name="vehismscle3" checked>capabilities sms
            <input type="checkbox" id="mms" class="pl" name="mms">capabilities mms
            <input type="checkbox" id="dateCreated" class="pl" name="dateCreated" checked>dateCreated
            <input type="checkbox" id="dateUpdated" class="pl" name="dateUpdated">dateUpdated
            <input type="checkbox" id="friendlyName" class="pl" name="friendlyName" checked>friendlyName
            <input type="checkbox" id="phoneNumber" class="pl" name="phoneNumber" checked>phoneNumber
            <input type="checkbox" id="sid" class="pl" name="sid" checked>sid
            <input type="checkbox" id="smsApplicationSid" class="pl" name="smsApplicationSid">smsApplicationSid
            <input type="checkbox" id="smsFallbackMethod" class="pl" name="smsFallbackMethod">smsFallbackMethod
            <input type="checkbox" id="smsFallbackUrl" class="pl" name="smsFallbackUrl">smsFallbackUrl
            <input type="checkbox" id="smsMethod" class="pl" name="smsMethod">smsMethod
            <input type="checkbox" id="smsUrl" class="pl" name="smsUrl">smsUrl
            <input type="checkbox" id="status" class="pl" name="status">status           
            <input type="checkbox" id="statusCallback" class="pl" name="statusCallback">statusCallback
            <input type="checkbox" id="statusCallbackMethod" class="pl" name="statusCallbackMethod">statusCallbackMethod
            <input type="checkbox" id="trunkSid" class="pl" name="trunkSid">trunkSid
            <input type="checkbox" id="uri" class="pl" name="uri">uri
            <input type="checkbox" id="voiceApplicationSid" class="pl" name="voiceApplicationSid">voiceApplicationSid
            <input type="checkbox" id="voiceCallerIdLookup" class="pl" name="voiceCallerIdLookup">voiceCallerIdLookup
            <input type="checkbox" id="voiceFallbackMethod" class="pl" name="voiceFallbackMethod">voiceFallbackMethod
            <input type="checkbox" id="voiceFallbackUrl" class="pl" name="voiceFallbackUrl">voiceFallbackUrl
            <input type="checkbox" id="voiceMethod" class="pl" name="voiceMethod">voiceMethod
            <input type="checkbox" id="voiceUrl" class="pl" name="smsvoiceUrlUrl">voiceUrl
            <input type="checkbox" id="emergencyStatus" class="pl" name="emergencyStatus">emergencyStatus
            <input type="checkbox" id="emergencyAddressSid" class="pl" name="emergencyAddressSid">emergencyAddressSid
         </div>
         <div>
            <form id="fetchSID" action="javascript:list_numbers()">
               <p>Enter the subaccount SID. Leave empty if you want the list of numbers on your main account. 
               </p>
               <input id="sAccount" type="text" name="sAccount" />
               <br />
               <div>Use Pagination?
               <select name="pagination" id="pagination">
                  <option value="Yes">Yes</option>
                  <option value="No" selected>No</option>
               </select>
               Maximum amount of numbers returned per page:
               <input type="number" id="page_size" name="page_size" min="1" max="1000" value="1"> </div>
               <br />
               <div><input id="lbutton" type="submit" value="List numbers" /></div>
            </form>
            <div> <button onclick="clear_list()">Clear list</button>
                  <button onclick="download()">Download listed numbers</button>
                  <button onclick="list_numbers(1)">Download without listing numbers</button></div>
            <pre></pre>
         
            <div id="info1" class="alert alert-info" style="display: none"></div>
            <div class="alert alert-error" style="display: none"></div>
         </div>
        <!-- EDIT_CODE -->
      </main>

    <script type="text/javascript">
  
const info = document.querySelector('.alert-info');
const error = document.querySelector('.alert-error');

async function list_numbers(down) {
  //event.preventDefault();

  try {
    info.innerHTML = `loading...`;

    const subaccount = document.getElementById("sAccount").value;
    const password = document.getElementById("password").value;
    const pagination = document.getElementById("pagination").value;
    const page_size = document.getElementById("page_size").value;

    var all_numbers = '';
    var page=0;
    var Pagetoken='';
    var pageAll=0;
    var columnAdded=0;

    console.log(pagination);

    info.style.display = 'none';
    error.style.display = 'none';
  while(pageAll==0){

    if (pagination==="No"){
      pageAll=1;
      var data = {
        subAcc: subaccount,
        pass: password,
      };
    }
    else {
        var data = {
        subAcc: subaccount,
        pass: password,
        pageSize: page_size,
        page:page,
        pageToken:Pagetoken,
      };
    }

    //console.log(data);
    var response = await fetch('./list_numbers', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),

    });
    console.log("response is");
    console.log(response);
    var json = await response.json();
    console.log(json);

    if (json.er == 0) {
      error.style.display = '';
      error.innerHTML = `Wrong password.`;
      console.log(response);
      return;

    }

  if (response.status === 200) {

    if(pagination==="Yes"){
      if (json.nextPageUrl){
        Pagetoken = json.nextPageUrl.split('PageToken\=')[1];
      }
      else{
        pageAll=1;
      }
      console.log(Pagetoken);
      page++;

      json=json.instances.slice();

    }

    var numNumbers = json.length;

    info.style.display = '';

    for (let i = 0; i < numNumbers; i++) {
      all_numbers = all_numbers + '<pre>';

      if (columnAdded==0) { //inserts column names
        if (document.getElementById('accountSid').checked) {
          all_numbers = all_numbers + 'AccountSID;';
        }
        if (document.getElementById('addressSid').checked) {
          all_numbers = all_numbers + 'addressSid;';
        }
        if (document.getElementById('addressRequirements').checked) {
          all_numbers = all_numbers + 'addressRequirements;';
        }
        if (document.getElementById('beta').checked) {
          all_numbers = all_numbers + 'beta;';
        }
        if (document.getElementById('bundleSid').checked) {
          all_numbers = all_numbers + 'bundleSid;';
        }
        if (document.getElementById('fax').checked) {
          all_numbers = all_numbers + 'fax;';
        }
        if (document.getElementById('voice').checked) {
          all_numbers = all_numbers + 'voice;';
        }
        if (document.getElementById('sms').checked) {
          all_numbers = all_numbers + 'sms;';
        }
        if (document.getElementById('mms').checked) {
          all_numbers = all_numbers + 'mms;';
        }
        if (document.getElementById('dateCreated').checked) {
          all_numbers = all_numbers + 'dateCreated;';
        }
        if (document.getElementById('dateUpdated').checked) {
          all_numbers = all_numbers + 'dateUpdated;';
        }
        if (document.getElementById('friendlyName').checked) {
          all_numbers = all_numbers + 'friendlyName;';
        }
        if (document.getElementById('phoneNumber').checked) {
          all_numbers = all_numbers + 'phoneNumber;';
        }
        if (document.getElementById('sid').checked) {
          all_numbers = all_numbers + 'sid;';
        }
        if (document.getElementById('smsApplicationSid').checked) {
          all_numbers = all_numbers + 'smsApplicationSid;';
        }
        if (document.getElementById('smsFallbackMethod').checked) {
          all_numbers = all_numbers + 'smsFallbackMethod;';
        }
        if (document.getElementById('smsFallbackUrl').checked) {
          all_numbers = all_numbers + 'smsFallbackUrl;';
        }
        if (document.getElementById('smsMethod').checked) {
          all_numbers = all_numbers + 'smsMethod;';
        }
        if (document.getElementById('smsUrl').checked) {
          all_numbers = all_numbers + 'smsUrl;';
        }
        if (document.getElementById('status').checked) {
          all_numbers = all_numbers + 'status;';
        }
        if (document.getElementById('statusCallback').checked) {
          all_numbers = all_numbers + 'statusCallback;';
        }
        if (document.getElementById('statusCallbackMethod').checked) {
          all_numbers = all_numbers + 'statusCallbackMethod;';
        }
        if (document.getElementById('trunkSid').checked) {
          all_numbers = all_numbers + 'trunkSid;';
        }
        if (document.getElementById('uri').checked) {
          all_numbers = all_numbers + 'uri;';
        }
        if (document.getElementById('voiceApplicationSid').checked) {
          all_numbers = all_numbers + 'voiceApplicationSid;';
        }
        if (document.getElementById('voiceCallerIdLookup').checked) {
          all_numbers = all_numbers + 'voiceCallerIdLookup;';
        }
        if (document.getElementById('voiceFallbackMethod').checked) {
          all_numbers = all_numbers + 'voiceFallbackMethod;';
        }
        if (document.getElementById('voiceFallbackUrl').checked) {
          all_numbers = all_numbers + 'voiceFallbackUrl;';
        }
        if (document.getElementById('voiceMethod').checked) {
          all_numbers = all_numbers + 'voiceMethod;';
        }
        if (document.getElementById('voiceUrl').checked) {
          all_numbers = all_numbers + 'voiceUrl;';
        }
        if (document.getElementById('emergencyStatus').checked) {
          all_numbers = all_numbers + 'emergencyStatus;';
        }
        if (document.getElementById('emergencyAddressSid').checked) {
          all_numbers = all_numbers + 'emergencyAddressSid;';
        }
        columnAdded=1;
      } else {
        if (document.getElementById('accountSid').checked) {
          all_numbers = all_numbers + json[i].accountSid + ';';
        }
        if (document.getElementById('addressSid').checked) {
          all_numbers = all_numbers + json[i].addressSid + ';';
        }
        if (document.getElementById('addressRequirements').checked) {
          all_numbers = all_numbers + json[i].addressRequirements + ';';
        }
        if (document.getElementById('beta').checked) {
          all_numbers = all_numbers + json[i].beta + ';';
        }
        if (document.getElementById('bundleSid').checked) {
          all_numbers = all_numbers + json[i].bundleSid + ';';
        }
        if (document.getElementById('fax').checked) {
          all_numbers = all_numbers + json[i].capabilities.fax + ';';
        }
        if (document.getElementById('voice').checked) {
          all_numbers = all_numbers + json[i].capabilities.voice + ';';
        }
        if (document.getElementById('sms').checked) {
          all_numbers = all_numbers + json[i].capabilities.sms + ';';
        }
        if (document.getElementById('mms').checked) {
          all_numbers = all_numbers + json[i].capabilities.mms + ';';
        }
        if (document.getElementById('dateCreated').checked) {
          all_numbers = all_numbers + json[i].dateCreated + ';';
        }
        if (document.getElementById('dateUpdated').checked) {
          all_numbers = all_numbers + json[i].dateUpdated + ';';
        }
        if (document.getElementById('friendlyName').checked) {
          all_numbers = all_numbers + json[i].friendlyName + ';';
        }
        if (document.getElementById('phoneNumber').checked) {
          all_numbers = all_numbers + json[i].phoneNumber + ';';
        }
        if (document.getElementById('sid').checked) {
          all_numbers = all_numbers + json[i].sid + ';';
        }
        if (document.getElementById('smsApplicationSid').checked) {
          all_numbers = all_numbers + json[i].smsApplicationSid + ';';
        }
        if (document.getElementById('smsFallbackMethod').checked) {
          all_numbers = all_numbers + json[i].smsFallbackMethod + ';';
        }
        if (document.getElementById('smsFallbackUrl').checked) {
          all_numbers = all_numbers + json[i].smsFallbackUrl + ';';
        }
        if (document.getElementById('smsMethod').checked) {
          all_numbers = all_numbers + json[i].smsMethod + ';';
        }
        if (document.getElementById('smsUrl').checked) {
          all_numbers = all_numbers + json[i].smsUrl + ';';
        }
        if (document.getElementById('status').checked) {
          all_numbers = all_numbers + json[i].status + ';';
        }
        if (document.getElementById('statusCallback').checked) {
          all_numbers = all_numbers + json[i].statusCallback + ';';
        }
        if (document.getElementById('statusCallbackMethod').checked) {
          all_numbers = all_numbers + json[i].statusCallbackMethod + ';';
        }
        if (document.getElementById('trunkSid').checked) {
          all_numbers = all_numbers + json[i].trunkSid + ';';
        }
        if (document.getElementById('uri').checked) {
          all_numbers = all_numbers + json[i].uri + ';';
        }
        if (document.getElementById('voiceApplicationSid').checked) {
          all_numbers = all_numbers + json[i].voiceApplicationSid + ';';
        }
        if (document.getElementById('voiceCallerIdLookup').checked) {
          all_numbers = all_numbers + json[i].voiceCallerIdLookup + ';';
        }
        if (document.getElementById('voiceFallbackMethod').checked) {
          all_numbers = all_numbers + json[i].voiceFallbackMethod + ';';
        }
        if (document.getElementById('voiceFallbackUrl').checked) {
          all_numbers = all_numbers + json[i].voiceFallbackUrl + ';';
        }
        if (document.getElementById('voiceMethod').checked) {
          all_numbers = all_numbers + json[i].voiceMethod + ';';
        }
        if (document.getElementById('voiceUrl').checked) {
          all_numbers = all_numbers + json[i].voiceUrl + ';';
        }
        if (document.getElementById('emergencyStatus').checked) {
          all_numbers = all_numbers + json[i].emergencyStatus + ';';
        }
        if (document.getElementById('emergencyAddressSid').checked) {
          all_numbers = all_numbers + json[i].emergencyAddressSid + ';';
        }
      } // else closed
    }//for closed
  } //if status 200 closed
  
  else {
  console.error(json.error);
  error.style.display = '';
  info.innerHTML = ``;
  error.innerHTML = `Something Wrong: ${json.error}`;
  return;
  }
}//while closed

 if (down==1){
    all_numbers = all_numbers.replace(/\"/g, "");
    all_numbers = all_numbers.replace(/<pre>/g, "%0D%0A");
    all_numbers = all_numbers.replace(/<\/pre>/g, "");
    var a = document.body.appendChild(
      document.createElement("a"));
    a.download = "listNumbers.txt";
    a.href = "data:text/plain," + all_numbers;
    a.click(); //Trigger a click on the element
    info.innerHTML = `done`;
  } 
  else {
    all_numbers = all_numbers.replace(/\"/g, "");
    info.innerHTML = `${all_numbers}`;
  } 

} catch (err) {
    //console.log (err);
    error.style.display = '';
    info.innerHTML = ``;
    error.innerHTML = `Something went wrong: ${err} - if you receive a JSON error, check if the inserted Account SID is correct and that it exists under the Main account you are using.`;

  }
}

function download() {
  var a = document.body.appendChild(
    document.createElement("a")
  );
  var newlines = document.getElementById("info1").innerHTML;
  a.download = "listNumbers.txt";
  newlines = newlines.replace(/<pre>/g, "%0D%0A");
  newlines = newlines.replace(/<\/pre>/g, "");
  a.href = "data:text/plain," + newlines;
  a.click(); //Trigger a click on the element

}

function checkAll() {
  var inputs = document.querySelectorAll('.pl');
  for (var i = 0; i < inputs.length; i++) {
    inputs[i].checked = true;
  }
}

async function mask (){
 
 const response = await fetch('./mask_account', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
    });

  var acc = await response.json();
  var masked= ('' + acc.acc).slice(0, 28)
        .replace(/./g, '*')
        + ('' + acc.acc).slice(-6);
 masking.innerHTML= masked;
 status_acc.innerHTML = ``;

}

async function unmask (){
 const password = document.getElementById("password").value;

     const data = {
      pass: password,
    };
 const response = await fetch('./get_account', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });
    var acc = await response.json();

    if (acc.er == 0) {
      status_acc.innerHTML = `Wrong password.`;

      return;

    }
  masking.innerHTML= acc.acc;
  status_acc.innerHTML = ``;

}

async function clear_list(){
  info.innerHTML=``;

}
    
      </script>
  </body>
</html>


